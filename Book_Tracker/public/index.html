<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book Reading Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen">
  <div class="container mx-auto px-4 py-8 max-w-7xl">
    <!-- Header -->
    <header class="mb-8">
      <h1 class="text-4xl font-bold text-slate-800 mb-2">ðŸ“š Book Reading Tracker</h1>
      <p class="text-slate-600">Track your reading progress and manage your book collection</p>
    </header>

    <!-- Statistics Section -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
      <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500">
        <div class="text-sm text-slate-600 mb-1">Total Books</div>
        <div class="text-3xl font-bold text-slate-800" id="totalBooks">0</div>
      </div>
      <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500">
        <div class="text-sm text-slate-600 mb-1">Books Finished</div>
        <div class="text-3xl font-bold text-slate-800" id="totalBooksRead">0</div>
      </div>
      <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-purple-500">
        <div class="text-sm text-slate-600 mb-1">Total Pages Read</div>
        <div class="text-3xl font-bold text-slate-800" id="totalPages">0</div>
      </div>
    </div>

    <!-- Add Book Button -->
    <div class="mb-6">
      <button onclick="toggleForm()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-200">
        + Add New Book
      </button>
    </div>

    <!-- Add Book Form -->
    <div id="bookForm" class="bg-white rounded-lg shadow-lg p-6 mb-8 hidden">
      <h2 class="text-2xl font-bold text-slate-800 mb-6">Add New Book</h2>
      <form onsubmit="handleSubmit(event)" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-2">Title *</label>
          <input type="text" id="title" required class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-2">Author *</label>
          <input type="text" id="author" required class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-2">Number of Pages *</label>
          <input type="number" id="numberOfPages" min="1" required class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-2">Pages Read *</label>
          <input type="number" id="pagesRead" min="0" value="0" required class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-2">Status *</label>
          <select id="status" required class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="Want to read">Want to read</option>
            <option value="Currently reading">Currently reading</option>
            <option value="Read">Read</option>
            <option value="Re-read">Re-read</option>
            <option value="DNF">DNF</option>
            <option value="Returned Unread">Returned Unread</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-2">Format *</label>
          <select id="format" required class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="Print">Print</option>
            <option value="PDF">PDF</option>
            <option value="Ebook">Ebook</option>
            <option value="AudioBook">AudioBook</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-2">Price *</label>
          <input type="number" id="price" min="0" step="0.01" required class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-2">Suggested By *</label>
          <input type="text" id="suggestedBy" required class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        
        <div class="md:col-span-2 flex gap-3">
          <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-200">
            Add Book
          </button>
          <button type="button" onclick="toggleForm()" class="bg-slate-300 hover:bg-slate-400 text-slate-800 font-semibold py-2 px-6 rounded-lg transition duration-200">
            Cancel
          </button>
        </div>
      </form>
    </div>

    <!-- Books List -->
    <div class="bg-white rounded-lg shadow-lg p-6">
      <h2 class="text-2xl font-bold text-slate-800 mb-6">My Books</h2>
      <div id="booksList" class="space-y-4">
        <!-- Books will be loaded here -->
      </div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:3000/api';
    let editingBookId = null;

    // Toggle form visibility
    function toggleForm() {
      const form = document.getElementById('bookForm');
      form.classList.toggle('hidden');
      if (!form.classList.contains('hidden')) {
        document.getElementById('bookForm').scrollIntoView({ behavior: 'smooth' });
      }
      if (editingBookId) {
        editingBookId = null;
        document.querySelector('form').reset();
        document.querySelector('h2').textContent = 'Add New Book';
        document.querySelector('button[type="submit"]').textContent = 'Add Book';
      }
    }

    // Load statistics
    async function loadStats() {
      try {
        const res = await fetch(`${API_URL}/books/stats`);
        const stats = await res.json();
        document.getElementById('totalBooks').textContent = stats.totalBooks;
        document.getElementById('totalBooksRead').textContent = stats.totalBooksRead;
        document.getElementById('totalPages').textContent = stats.totalPages.toLocaleString();
      } catch (error) {
        console.error('Error loading stats:', error);
      }
    }

    // Load all books
    async function loadBooks() {
      try {
        const res = await fetch(`${API_URL}/books`);
        const books = await res.json();
        const booksList = document.getElementById('booksList');
        
        if (books.length === 0) {
          booksList.innerHTML = '<p class="text-slate-500 text-center py-8">No books yet. Add your first book!</p>';
          return;
        }
        
        booksList.innerHTML = books.map(book => {
          const progress = Math.round((book.pagesRead / book.numberOfPages) * 100);
          const statusColor = book.finished ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800';
          
          return `
            <div class="border border-slate-200 rounded-lg p-4 hover:shadow-md transition duration-200">
              <div class="flex justify-between items-start mb-3">
                <div class="flex-1">
                  <h3 class="text-xl font-semibold text-slate-800">${book.title}</h3>
                  <p class="text-slate-600">by ${book.author}</p>
                </div>
                <div class="flex gap-2">
                  <button onclick="editBook('${book._id}')" class="text-blue-600 hover:text-blue-800 font-medium px-3 py-1">Edit</button>
                  <button onclick="deleteBook('${book._id}')" class="text-red-600 hover:text-red-800 font-medium px-3 py-1">Delete</button>
                </div>
              </div>
              
              <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-3 text-sm">
                <div><span class="text-slate-600">Format:</span> <span class="font-medium">${book.format}</span></div>
                <div><span class="text-slate-600">Status:</span> <span class="font-medium">${book.status}</span></div>
                <div><span class="text-slate-600">Price:</span> <span class="font-medium">$${book.price.toFixed(2)}</span></div>
                <div><span class="text-slate-600">Suggested by:</span> <span class="font-medium">${book.suggestedBy}</span></div>
              </div>
              
              <div class="mb-2">
                <div class="flex justify-between text-sm mb-1">
                  <span class="text-slate-600">Progress: ${book.pagesRead} / ${book.numberOfPages} pages</span>
                  <span class="font-semibold text-slate-800">${progress}%</span>
                </div>
                <div class="w-full bg-slate-200 rounded-full h-3">
                  <div class="bg-blue-600 h-3 rounded-full transition-all duration-300" style="width: ${progress}%"></div>
                </div>
              </div>
              
              ${book.finished ? '<span class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">âœ“ Finished</span>' : ''}
            </div>
          `;
        }).join('');
      } catch (error) {
        console.error('Error loading books:', error);
      }
    }

    // Handle form submission
    async function handleSubmit(event) {
      event.preventDefault();
      
      const bookData = {
        title: document.getElementById('title').value,
        author: document.getElementById('author').value,
        numberOfPages: parseInt(document.getElementById('numberOfPages').value),
        pagesRead: parseInt(document.getElementById('pagesRead').value),
        status: document.getElementById('status').value,
        format: document.getElementById('format').value,
        price: parseFloat(document.getElementById('price').value),
        suggestedBy: document.getElementById('suggestedBy').value
      };
      
      try {
        const url = editingBookId ? `${API_URL}/books/${editingBookId}` : `${API_URL}/books`;
        const method = editingBookId ? 'PUT' : 'POST';
        
        const res = await fetch(url, {
          method,
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(bookData)
        });
        
        if (res.ok) {
          event.target.reset();
          toggleForm();
          await loadBooks();
          await loadStats();
        }
      } catch (error) {
        console.error('Error saving book:', error);
        alert('Error saving book. Please try again.');
      }
    }

    // Edit book
    async function editBook(id) {
      try {
        const res = await fetch(`${API_URL}/books`);
        const books = await res.json();
        const book = books.find(b => b._id === id);
        
        if (book) {
          editingBookId = id;
          document.getElementById('title').value = book.title;
          document.getElementById('author').value = book.author;
          document.getElementById('numberOfPages').value = book.numberOfPages;
          document.getElementById('pagesRead').value = book.pagesRead;
          document.getElementById('status').value = book.status;
          document.getElementById('format').value = book.format;
          document.getElementById('price').value = book.price;
          document.getElementById('suggestedBy').value = book.suggestedBy;
          
          document.querySelector('#bookForm h2').textContent = 'Edit Book';
          document.querySelector('button[type="submit"]').textContent = 'Update Book';
          document.getElementById('bookForm').classList.remove('hidden');
          document.getElementById('bookForm').scrollIntoView({ behavior: 'smooth' });
        }
      } catch (error) {
        console.error('Error loading book:', error);
      }
    }

    // Delete book
    async function deleteBook(id) {
      if (!confirm('Are you sure you want to delete this book?')) return;
      
      try {
        const res = await fetch(`${API_URL}/books/${id}`, { method: 'DELETE' });
        if (res.ok) {
          await loadBooks();
          await loadStats();
        }
      } catch (error) {
        console.error('Error deleting book:', error);
        alert('Error deleting book. Please try again.');
      }
    }

    // Initial load
    loadBooks();
    loadStats();
  </script>
</body>
</html>